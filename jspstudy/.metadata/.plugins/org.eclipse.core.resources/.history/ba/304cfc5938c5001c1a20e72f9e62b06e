package service;

import java.io.IOException;
import java.util.Optional;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import common.ActionForward;
import repository.BoardDAO;
import repository.FreeDAO;

public class DetailService implements FreeService {

	@Override
	public ActionForward execute(HttpServletRequest request, HttpServletResponse response) throws IOException {

		Optional<String> optFreeNo = Optional.ofNullable(request.getParameter("freeNo"));
		Long freeNo = Long.parseLong(optFreeNo.orElse("0"));
		
		HttpSession session = request.getSession();
		if(session.getAttribute("open") == null) {
			session.setAttribute("open", true);
			
			// 조회수 늘리기
			// UPDATE 이후에는 redirect를 해야 한다. (물론 아몰랑~하고 forward 할 수도 있음)
			int res = FreeDAO.getInstance().updateHit(freeNo);
			if(res == 0) {
				return new ActionForward("/DBCP_PRAC/list.do", true);
			}
			
		}
		
		request.setAttribute("board", FreeDAO.getInstance().selectBoardByFreeNo(freeNo));
		
		return new ActionForward("free/detail.jsp", false);
	}

}
